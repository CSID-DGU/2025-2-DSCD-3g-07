# 기상청 API 데이터 예시

## 📍 작동 방식

### 1. GPS 위치 → 격자 좌표 변환
```
사용자 GPS: 37.5665°N, 126.9780°E (서울)
        ↓ convertToGrid() 함수
기상청 격자: nx=60, ny=127
```

### 2. 기상청 API가 제공하는 원본 데이터

```json
{
  "response": {
    "header": {
      "resultCode": "00",
      "resultMsg": "NORMAL_SERVICE"
    },
    "body": {
      "items": {
        "item": [
          {
            "baseDate": "20251027",
            "baseTime": "0500",
            "category": "TMP",
            "fcstDate": "20251027",
            "fcstTime": "0600",
            "fcstValue": "12",
            "nx": 60,
            "ny": 127
          },
          {
            "category": "REH",
            "fcstValue": "65"
          },
          {
            "category": "POP",
            "fcstValue": "30"
          },
          // ... 더 많은 항목들
        ]
      }
    }
  }
}
```

## 🌤️ 변환 후 화면에 표시되는 데이터

### 현재 날씨 (current)
```typescript
{
  time: "2025-10-27T06:00",           // 예보 시각
  temperature_2m: 12,                  // 기온 (℃)
  relative_humidity_2m: 65,            // 습도 (%)
  apparent_temperature: 11.5,          // 체감온도 (℃)
  precipitation: 0,                    // 강수량 (mm)
  rain: 0,                            // 비 (mm)
  weather_code: 2,                    // 날씨 코드
  wind_speed_10m: 1.5,                // 풍속 (m/s)
  wind_direction_10m: 225             // 풍향 (degree)
}
```

### 시간별 예보 (hourly) - 최대 72시간
```typescript
{
  time: [
    "2025-10-27T06:00",
    "2025-10-27T07:00",
    "2025-10-27T08:00",
    // ... 72시간
  ],
  temperature_2m: [12, 13, 14, ...],        // 시간별 기온
  relative_humidity_2m: [65, 60, 58, ...],  // 시간별 습도
  precipitation_probability: [30, 20, 10, ...], // 강수 확률
  precipitation: [0, 0, 0.5, ...],          // 강수량
  weather_code: [2, 1, 0, ...],             // 날씨 코드
  wind_speed_10m: [1.5, 2.0, 1.8, ...],    // 풍속
  wind_direction_10m: [225, 230, 220, ...]  // 풍향
}
```

### 일별 예보 (daily) - 최대 3일
```typescript
{
  time: ["2025-10-27", "2025-10-28", "2025-10-29"],
  weather_code: [2, 1, 0],                    // 대표 날씨
  temperature_2m_max: [18, 20, 19],          // 최고기온
  temperature_2m_min: [10, 11, 12],          // 최저기온
  precipitation_sum: [2.5, 0, 0],            // 일 강수량 합계
  precipitation_probability_max: [60, 20, 10], // 최대 강수확률
  wind_speed_10m_max: [3.5, 2.8, 2.0]       // 최대 풍속
}
```

## 🎨 화면 표시 예시

### WeatherTestScreen에서 보이는 정보

#### 1️⃣ 현재 날씨 섹션
```
🌤️ 현재 날씨
구름많음 ⛅

🌡️ 12°C (체감 11.5°C)

상세 정보:
├─ 습도: 65%
├─ 풍속: 1.5 m/s (남서)
├─ 강수량: 0 mm
└─ 비: 0 mm (비 올 때만 표시)
```

#### 2️⃣ 위치 정보
```
📍 위치 정보
├─ 위도: 37.5665°
├─ 경도: 126.9780°
└─ 시간대: Asia/Seoul
```

#### 3️⃣ 시간별 예보 (처음 12시간)
```
⏰ 시간별 예보
06:00 | ⛅ 구름많음 | 12°C (60%)
07:00 | ⛅ 구름많음 | 13°C (50%)
08:00 | 🌤️ 대체로 맑음 | 14°C (40%)
...
```

#### 4️⃣ 일별 예보 (5일)
```
📅 일별 예보
월 | ⛅ 구름많음 | 18° / 10° | 강수 2.5mm | 확률 60%
화 | 🌤️ 대체로 맑음 | 20° / 11°
수 | ☀️ 맑음 | 19° / 12°
```

## 🔢 기상청 코드표

### 강수형태 (PTY)
- `0`: 없음
- `1`: 비 🌧️
- `2`: 비/눈 🌨️
- `3`: 눈 ❄️
- `4`: 소나기 ⛈️
- `5`: 빗방울 🌦️
- `6`: 빗방울/눈날림
- `7`: 눈날림

### 하늘상태 (SKY)
- `1`: 맑음 ☀️
- `3`: 구름많음 ⛅
- `4`: 흐림 ☁️

### Weather Code 변환
```typescript
// 강수형태가 있으면 우선
if (PTY === 1) → 61 (비)
if (PTY === 2 || PTY === 3) → 71 (눈)
if (PTY === 4) → 80 (소나기)

// 강수형태가 없으면 하늘상태
if (SKY === 1) → 0 (맑음)
if (SKY === 3) → 2 (구름많음)
if (SKY === 4) → 3 (흐림)
```

## 🧪 테스트 방법

### 콘솔에서 확인하기
앱을 실행하고 개발자 도구를 열면 다음과 같은 로그를 볼 수 있습니다:

```javascript
// 기상청 원본 데이터
console.log('기상청 API 원본:', kmaData);

// 변환된 데이터
console.log('변환된 날씨 데이터:', {
  현재위치: { lat, lon },
  격자좌표: { nx, ny },
  현재날씨: current,
  시간별예보: hourly,
  일별예보: daily
});
```

### GPS 위치별 테스트
1. **서울**: `(37.5665, 126.9780)` → 격자 `(60, 127)`
2. **부산**: `(35.1796, 129.0756)` → 격자 `(98, 76)`
3. **제주**: `(33.4996, 126.5312)` → 격자 `(52, 38)`
4. **현재 위치**: GPS 켜면 자동으로 격자 변환

## 🚨 주의사항

### 데이터 제공 시간
- 기상청은 **2시간 전** 데이터 제공
- 예: 현재 08:00 → 06:00 발표 데이터 사용

### 예보 범위
- **단기예보**: 3일 (72시간)
- **초단기예보**: 6시간 (별도 API)

### 격자 해상도
- 약 **5km × 5km** 격자
- 같은 도시 내에서도 약간의 오차 가능

## 💡 디버깅 팁

### 데이터가 안 보일 때
1. API 키 확인
2. 네트워크 요청 확인 (개발자 도구)
3. 격자 좌표 변환 확인
4. 콘솔 에러 확인

### 콘솔 로그 추가 예시
```typescript
// weatherService.ts의 getCurrentWeather 함수에 추가
console.log('🌍 요청 위치:', { lat, lon });
console.log('📍 격자 좌표:', { nx, ny });
console.log('📅 발표 시각:', { baseDate, baseTime });
console.log('📦 기상청 응답:', kmaData);
console.log('✅ 변환 완료:', result);
```
