# 기상청 API 작동 방식 - 간단 요약 ⚡

## ✅ GPS 위치 → 날씨 자동 변환

### 작동 원리
```
1. 사용자가 GPS 켜기 (또는 서울 기본값)
   ↓
2. 위경도 좌표 (예: 37.5665°N, 126.9780°E)
   ↓
3. 기상청 격자 좌표로 자동 변환 (예: nx=60, ny=127)
   ↓
4. 기상청 API 호출
   ↓
5. 화면에 날씨 표시!
```

**→ Open Meteo와 100% 동일하게 작동합니다!**

---

## 📱 화면에 보이는 정보

### 1. 현재 날씨
```
🌤️ 구름많음 ⛅
🌡️ 12°C (체감 11.5°C)

├─ 습도: 65%
├─ 풍속: 1.5 m/s (남서)
└─ 강수량: 0 mm
```

### 2. 시간별 예보 (12시간)
```
06:00 | ⛅ 12°C (60%)
07:00 | ⛅ 13°C (50%)
08:00 | 🌤️ 14°C (40%)
...
```

### 3. 일별 예보 (5일)
```
월 | ⛅ | 18° / 10° | 비 2.5mm (60%)
화 | 🌤️ | 20° / 11°
수 | ☀️ | 19° / 12°
```

---

## 🔍 실제 데이터 확인하는 법

### 방법 1: 앱 실행하고 콘솔 확인
```bash
# 프론트엔드 실행
cd frontend
npm start
```

**개발자 도구 열기 (웹):**
- Chrome: `F12` 또는 `Ctrl + Shift + I`
- Safari: `Cmd + Option + I`

**콘솔에서 볼 수 있는 정보:**
```javascript
🌍 [기상청 API] 날씨 요청: {
  입력위치: { 위도: 37.5665, 경도: 126.978 },
  격자좌표: { nx: 60, ny: 127 },
  발표일시: { baseDate: "20251027", baseTime: "0500" }
}

📦 [기상청 API] 원본 응답: {
  상태: { resultCode: "00", resultMsg: "NORMAL_SERVICE" },
  데이터개수: 312,
  샘플: [...]
}

🌡️ [현재 날씨]: {
  시각: "2025-10-27T06:00",
  기온: "12℃",
  습도: "65%",
  강수확률: "30%",
  강수형태: "없음",
  하늘상태: "구름많음",
  풍속: "1.5m/s"
}

✅ [기상청 API] 변환된 데이터: {
  현재날씨: {...},
  시간별예보_개수: 72,
  일별예보_개수: 3
}
```

### 방법 2: React Native 디버거
```bash
# Expo 앱에서
# 1. 앱 실행 중 흔들기
# 2. "Debug Remote JS" 선택
# 3. Chrome에서 http://localhost:19000/debugger-ui 열림
# 4. 콘솔 탭에서 로그 확인
```

---

## 📊 기상청 API가 제공하는 값들

### 기본 데이터 (카테고리)
| 코드 | 이름 | 단위 | 예시 |
|------|------|------|------|
| TMP | 기온 | ℃ | 12 |
| REH | 습도 | % | 65 |
| POP | 강수확률 | % | 30 |
| PTY | 강수형태 | 코드 | 0=없음, 1=비, 3=눈 |
| SKY | 하늘상태 | 코드 | 1=맑음, 3=구름많음, 4=흐림 |
| PCP | 강수량 | mm | 1mm |
| WSD | 풍속 | m/s | 1.5 |
| VEC | 풍향 | degree | 225 (남서) |

### 변환된 화면 표시
```
기상청 PTY=1 (비) + SKY=4 (흐림)
    ↓ 변환
화면: "비 🌧️" (weather_code=61)

기상청 PTY=0 (없음) + SKY=3 (구름많음)
    ↓ 변환
화면: "구름많음 ⛅" (weather_code=2)
```

---

## 🎯 주요 차이점

### Open Meteo vs 기상청

| 항목 | Open Meteo | 기상청 |
|------|-----------|--------|
| 좌표 | 위경도 직접 | 격자 변환 필요 ✓ |
| 예보 범위 | 7일+ | 3일 (72시간) |
| 업데이트 | 실시간 | 2시간 전 데이터 |
| 해상도 | 고해상도 | 5km 격자 |
| 한국 데이터 | 글로벌 모델 | 한국 기상청 공식 ⭐ |

**→ 한국 지역은 기상청이 더 정확합니다!**

---

## 🧪 테스트해보기

### 1. 서울 날씨 보기
```typescript
// 자동으로 서울 좌표 사용
SEOUL_COORDS = { latitude: 37.5665, longitude: 126.9780 }
```

### 2. GPS 위치 사용
```typescript
// WeatherTestScreen에서
// "현재 위치 사용" 토글 ON
// → 자동으로 GPS 위치의 격자 좌표로 변환
```

### 3. 다른 도시 테스트
```typescript
// 부산
getCurrentWeather(35.1796, 129.0756)

// 제주
getCurrentWeather(33.4996, 126.5312)

// 강릉
getCurrentWeather(37.7519, 128.8761)
```

---

## ❓ 문제 해결

### 날씨가 안 나올 때
1. **콘솔 확인**: 에러 메시지 확인
2. **네트워크 확인**: API 응답 코드 확인
3. **API 키 확인**: weatherService.ts의 KMA_API_KEY
4. **시간 확인**: 기상청은 2시간 전 데이터 제공

### 이상한 값이 나올 때
```javascript
// 콘솔에서 원본 데이터 확인
console.log('원본 기상청 데이터:', kmaData);

// 카테고리별 값 확인
console.log('TMP:', firstData.TMP);  // 기온
console.log('PTY:', firstData.PTY);  // 강수형태
console.log('SKY:', firstData.SKY);  // 하늘상태
```

---

## 📝 정리

**질문: GPS 위치에 따라 날씨 보여주나요?**
→ **네! 100% 작동합니다!** ✅

**과정:**
1. GPS 좌표 받기 (또는 서울 기본값)
2. 자동으로 격자 좌표 변환
3. 기상청 API 호출
4. 화면에 날씨 표시

**보이는 정보:**
- ✅ 현재 날씨 (기온, 습도, 풍속, 강수)
- ✅ 시간별 예보 (72시간)
- ✅ 일별 예보 (3일)
- ✅ 날씨 이모지와 설명

**Open Meteo와 동일하게 작동하며, 한국 지역에서 더 정확합니다!** 🎉
