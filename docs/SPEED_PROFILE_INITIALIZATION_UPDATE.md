# 사용자 속도 프로필 초기화 및 관리 개선

## 📋 개요

사용자의 보행 속도 데이터 관리 방식을 개선하여 헬스커넥트 사용 여부와 관계없이 일관된 사용자 경험을 제공하도록 변경했습니다.

## 🔄 주요 변경 사항

### 1. 속도 데이터 소스 변경

**변경 전:**
- 홈 화면에서 헬스커넥트에서 직접 속도 데이터 조회
- 헬스커넥트 없는 사용자는 속도 정보 표시 안 됨
- DB에 저장된 속도 프로필 미활용

**변경 후:**
- 모든 화면에서 DB의 `speed_profile` 조회
- 헬스커넥트 없어도 기본 속도(4km/h) 표시
- 단일 데이터 소스로 일관성 확보

### 2. 초기 속도 설정 통일

**파일:** `backend/app/constants/speed_constants.py`

```python
# 변경 전
DEFAULT_WALKING_SPEED_CASE1 = 4.0  # 경로 안내용
DEFAULT_WALKING_SPEED_CASE2 = 3.2  # 코스 추천용 (4.0 * 0.8)

# 변경 후
DEFAULT_WALKING_SPEED_CASE1 = 4.0  # 경로 안내용
DEFAULT_WALKING_SPEED_CASE2 = 4.0  # 코스 추천용 (초기값 동일)
```

**이유:** 모든 신규 사용자가 동일한 4km/h에서 시작하도록 통일

### 3. Case2 비율 조정

**파일:** `backend/app/constants/speed_constants.py`

```python
# 변경 전
SLOW_WALK_SPEED_RATIO = 0.8  # Case2 = Case1 × 0.8

# 변경 후
SLOW_WALK_SPEED_RATIO = 0.9  # Case2 = Case1 × 0.9
```

**비교:**
| Case 1 | Case 2 (0.8) | Case 2 (0.9) |
|--------|--------------|--------------|
| 4.0 km/h | 3.2 km/h | 3.6 km/h |
| 5.0 km/h | 4.0 km/h | 4.5 km/h |

**이유:** 경로 안내(Case1)와 코스 추천(Case2)의 차이를 10%로 줄여 더 실용적으로 개선

### 4. 비로그인 사용자 오류 처리

**파일:** 
- `frontend/app/(tabs)/index.tsx`
- `frontend/components/ApiTestComponent.tsx`

**변경 전:**
```typescript
console.warn('⚠️ 속도 데이터 로드 실패:', error);
// → 콘솔에 경고 표시, 사용자에게 혼란
```

**변경 후:**
```typescript
console.log('ℹ️ 로그인 필요 - 기본 속도 사용');
// → 조용히 처리, 기본값으로 대체
```

## 📊 사용자별 속도 관리 흐름

### A. 헬스커넥트 없는 사용자

```
회원가입
  ↓
DB에 기본값 저장 (4.0, 4.0)
  ↓
경로 사용
  ↓
실측 속도로 자동 업데이트
  ↓
Case1 업데이트 시 Case2 = Case1 × 0.9
```

### B. 헬스커넥트 있는 사용자

```
회원가입
  ↓
DB에 기본값 저장 (4.0, 4.0)
  ↓
헬스 데이터 조회 성공
  ↓
DB 업데이트 (실제 Case1, Case2 값)
  ↓
경로 사용 시 추가 업데이트
```

### C. 비로그인 사용자

```
앱 실행
  ↓
DB 조회 실패 (토큰 없음)
  ↓
조용히 무시, 기본값 사용
  ↓
UI에 4.0 km/h 표시
```

## 🎯 개선 효과

### 1. 일관된 데이터 관리
- ✅ 단일 데이터 소스 (DB `speed_profile`)
- ✅ 헬스커넥트 의존성 제거
- ✅ 모든 화면에서 동일한 속도 사용

### 2. 향상된 사용자 경험
- ✅ 헬스커넥트 없어도 속도 정보 표시
- ✅ 비로그인 상태에서도 오류 없이 동작
- ✅ 초기 설정 단순화 (4km/h 통일)

### 3. 실용적인 속도 구분
- ✅ Case1과 Case2 차이 10% (기존 20%)
- ✅ 더 현실적인 느린 걸음 속도 반영

## 📝 수정된 파일 목록

### Backend
- `app/constants/speed_constants.py`
  - `SLOW_WALK_SPEED_RATIO`: 0.8 → 0.9
  - `DEFAULT_WALKING_SPEED_CASE2`: 3.2 → 4.0

### Frontend
- `app/(tabs)/index.tsx`
  - 헬스커넥트 → DB 조회로 변경
  - 비로그인 오류 처리 개선
  - UI에 기본값 표시 추가

- `components/ApiTestComponent.tsx`
  - 헬스커넥트 → DB 조회로 변경
  - import 수정 (`healthConnectService` → `apiService`)
  - 비로그인 오류 처리 개선

## ✅ 테스트 시나리오

### 시나리오 1: 신규 회원가입 (헬스커넥트 없음)
1. 회원가입 완료
2. DB에 4.0/4.0 저장
3. 홈 화면에서 4.0 km/h 표시
4. 경로 사용 후 실측 속도로 업데이트

### 시나리오 2: 신규 회원가입 (헬스커넥트 있음)
1. 회원가입 완료
2. DB에 4.0/4.0 저장
3. 헬스 데이터 조회 (예: 4.5/3.8)
4. DB 업데이트
5. 홈 화면에서 4.5 km/h 표시

### 시나리오 3: 비로그인 사용
1. 앱 실행
2. DB 조회 실패
3. 조용히 처리, 기본값 사용
4. UI에 4.0 km/h 표시

## 🔮 향후 고려사항

1. **Case2 비율의 개인화**
   - 현재: 고정 0.9 비율
   - 제안: 사용자별 느린 걸음 패턴 학습 가능성

2. **속도 업데이트 로직 최적화**
   - 현재: 경로 사용 시 자동 업데이트
   - 제안: 신뢰도 기반 선택적 업데이트

3. **다양한 활동 타입 지원**
   - 현재: walking만 지원
   - 제안: running, cycling 등 확장 가능

---

**작성일:** 2025년 11월 27일  
**버전:** 1.0.0  
**담당:** 속도 프로필 관리 개선 프로젝트
